version: '3.0'

networks:
  guacnetwork_compose:
    driver: bridge

services:
    guacamole:
        container_name: guacamole
        links:
            - 'guacd:guacd'
            - 'mysql:mysql'
        ports:
            - '8080:8080'
        image: guacamole/guacamole
        environment:
         MYSQL_HOSTNAME: mysql
         MYSQL_PORT: 3306
         GUACD_HOSTNAME: guacd
         MYSQL_DATABASE: guacamole_db  
         MYSQL_USER: guacamole_user    
         MYSQL_PASSWORD: guacamole_password
        depends_on:
            - guacd
            - mysql
        networks:
          guacnetwork_compose:
    guacd:
        container_name: guacd
        image: guacamole/guacd
        restart: always
        networks:
          guacnetwork_compose:
    mysql:
        container_name: mysql
        image: mysql/mysql-server
        environment:
         MYSQL_DATABASE: guacamole_db
         MYSQL_USER: guacamole_user
         MYSQL_PASSWORD: guacamole_password
         MYSQL_ROOT_PASSWORD: guacamole_root
        networks:
          guacnetwork_compose:
##      command: mysqld --socket=/tmp/mysqld.sock          <-------------- uncomment if you are using this in windows.
        volumes:
        - ./data:/var/lib/mysql
    nginx:
         container_name: nginx
         restart: always
         image: nginx
         volumes:
          - ./nginx/ssl/self.cert:/etc/nginx/ssl/self.cert:ro
          - ./nginx/ssl/self-ssl.key:/etc/nginx/ssl/self-ssl.key:ro
          - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
          - ./nginx/mysite.template:/etc/nginx/conf.d/default.conf:ro
         ports:
           - 443:443
         links:
           - guacamole
         networks:
           guacnetwork_compose:
         command: /bin/bash -c "nginx -g 'daemon off;'"


